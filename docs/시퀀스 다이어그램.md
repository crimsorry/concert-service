## 전체 구조

![Image](https://github.com/user-attachments/assets/2b216805-fdd9-47f9-b7fe-9ca358921523)

## 각 기능 별 흐름 설계

![Image](https://github.com/user-attachments/assets/2cec5cd8-1190-496d-a1a5-80d31029a320)

#### - 사용자가 토큰 생성 요청 시 시스템이 DB에서 기존 토큰 확인 후 있으면 반환, 없으면 새 토큰 생성하여 반환하는 흐름
#### - QUEUE (stand_by)
<br>

![Image](https://github.com/user-attachments/assets/70ae601a-8db3-4bf6-ad95-b3714079ddab)
#### - 사용자가 토큰 순번 조회 요청 시 시스템이 DB에서 순번 확인 후 반환하는 흐름. 
#### - 폴링 용.
#### - 내 차례 시 > QUEUE (active)

![Image](https://github.com/user-attachments/assets/8e1991f0-69e3-44a2-8e83-e52a5472c2c5)

#### - 사용자가 예약 가능 날짜 조회 시 시스템이 DB에서 날짜 목록 확인 후 예약 가능 목록 반환하는 흐름
#### - 클라이언트에서 폴링 후, 늘 ACTIVE 상태인 유저가 들어온다고 가정

<br>

![Image](https://github.com/user-attachments/assets/84769f38-6cea-4259-8b38-c4cf8133ec54)

#### - 사용자가 예약 가능 좌석 조회 시 시스템이 DB에서 토큰 확인 후 있으면 대기열 상태 확인. 이후 폴링을 통해 대기 순번 확인

<br>

![Image](https://github.com/user-attachments/assets/42450d7c-6316-45c7-82a8-22346495fc3d)

#### - 사용자가 좌석 예약 생성 시 시스템이 DB에서 좌석 상태 확인 후 '선택 가능한 좌석' 이라면 임시 배정 성공 반환, 아니라면 에러 메세지를 반환하는 흐름
#### - 스케쥴러를 통한 좌석 임시배정 상태 확인
<br>

![Image](https://github.com/user-attachments/assets/df9b5b3c-6cda-44e8-84e6-1f90b01df77a)

#### - 사용자가 잔액 충전 시 시스템이 DB에서 충전 금액 확인 후 충전 성공 반환, 충전 금액이 정책과 맞지 않다면 에러 메시지를 반환하는 흐름
<br>

![Image](https://github.com/user-attachments/assets/08e8ab54-7a6e-469c-b0d7-babcb432c1d7)

#### - 사용자가 잔액 조회 시 시스템이 DB에서 잔액 조회 후 반환하는 흐름
<br>

![Image](https://github.com/user-attachments/assets/e909acc2-c860-4794-b334-5819d6c4ba28)

#### - 사용자가 결제 요청 시 시스템이 DB에서 좌석 상태 확인 후 '임시배정 좌석' 이고, '결제 대기' 상태라면 결제 성공 반환, 아니라면 에러 메세지를 반환하는 흐름
#### - 완료 시 > QUEUE (expired)
