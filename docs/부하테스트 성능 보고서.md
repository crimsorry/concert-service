# ğŸ§© ë¶€í•˜í…ŒìŠ¤íŠ¸ + ì¥ì•  ëŒ€ì‘ ë³´ê³ ì„œ



## ğŸ§© í…ŒìŠ¤íŠ¸ í™˜ê²½

- OS: Window
- CPU: 8 Core
- Memory: 16GB
- Storage: 220GB SSD
- ì‹¤í–‰í™˜ê²½: Docker
- ë¶€í•˜í…ŒìŠ¤íŠ¸: K6
- ì„±ëŠ¥ í™•ì¸ ë„êµ¬: InfluxDB, Grafana



## ğŸ§© ê°œìš”

* **ì‹œìŠ¤í…œ í•œê³„ì  ë¶„ì„**
  - **ë¶€í•˜ê°€ ì§‘ì¤‘ë  ê°€ëŠ¥ì„±ì´ ë†’ì€ ì‹œë‚˜ë¦¬ì˜¤**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹œìŠ¤í…œì˜ ë³‘ëª© í˜„ìƒì„ ì‹ë³„.
  - ë³‘ëª© êµ¬ê°„ì„ íŒŒì•…í•œ í›„ **ë¦¬íŒ©í† ë§ ë° ìµœì í™” ì „ëµ**ì„ í†µí•´ ì„±ëŠ¥ ê°œì„ .
* **Stress Test (ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸)**
  - ì‹œìŠ¤í…œì´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” **ìµœëŒ€ ì‚¬ìš©ì ìš”ì²­ ìˆ˜**ë¥¼ ì¸¡ì •í•˜ì—¬, í•œê³„ì  ë¶„ì„.
  - ìµœëŒ€ ë¶€í•˜ ì¡°ê±´ì—ì„œ ë°œìƒ ê°€ëŠ¥í•œ ë¬¸ì œë¥¼ í™•ì¸í•˜ê³ , **ìŠ¤ì¼€ì¼ë§ ì „ëµ** ë„ì¶œ.
* **Load Test (ë¶€í•˜ í…ŒìŠ¤íŠ¸)**
  * **ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥í•œ ì‚¬ìš©ì ìš”ì²­ ìˆ˜**ë¥¼ ì¸¡ì •
  * íš¨ìœ¨ì„±ê³¼ ì•ˆì •ì„±ì„ ëª¨ë‘ ì¶©ì¡±í•˜ëŠ” **ìµœì  ìš´ì˜ ì¡°ê±´** ì„¤ì •.



## ğŸ§© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

| ì¼€ì´ìŠ¤                            | ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤           | ì‹¤ì œ ê²°ê³¼                  |
| --------------------------------- | ----------------------- | -------------------------- |
| ëŒ€ê¸°ì—´ ìƒì„±                       | ë™ì‹œ ì ‘ì†ì ìˆ˜ : 10,000 | ë™ì‹œ ì ‘ì†ì ìˆ˜ : 12,000    |
| ëŒ€ê¸°ì—´ ìƒì„± > ì½˜ì„œíŠ¸ ì¡°íšŒ         | ìºì‹œ ì‘ë‹µì‹œê°„ ì¼ì •      | ìºì‹œ ë¯¸ìŠ¤ > ì›ì¸ë¶„ì„       |
| ëŒ€ê¸°ì—´ ìƒì„± &gt; ì½˜ì„œíŠ¸ ì¼ì • ì¡°íšŒ | ë™ì‹œ ì ‘ì†ì ìˆ˜ : 600    | connection poll > ì›ì¸ë¶„ì„ |



## ğŸ§© ë³‘ëª© ë°œìƒ

#### 1. Redis ë¶€í•˜

* ëŒ€ëŸ‰ ë°ì´í„°ë¥¼ ìºì‹±í•˜ë©° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê¸‰ì¦ ë° ì„±ëŠ¥ ì €í•˜ ë°œìƒ.

#### 2. ìºì‹± ì „ëµ ë¶€ì¬

* ë¹„íš¨ìœ¨ì ì¸ ìºì‹± ì„¤ê³„ë¡œ ì¸í•´ ìºì‹œ ì ì¤‘ë¥  ê°ì†Œ ë° Redis ì„±ëŠ¥ ì €í•˜.

#### 3. ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜

* ê³¼ë„í•œ ë°ì´í„° ì¡°íšŒ ìš”ì²­ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì§‘ì¤‘ë˜ë©´ì„œ ì‘ë‹µ ì†ë„ ì§€ì—°.

#### 4. ì„œë²„ ë¦¬ì†ŒìŠ¤ ë¶€ì¡±

* ìµœì†Œ ë¦¬ì†ŒìŠ¤ ì„¤ì •(CPU 1 core, ë©”ëª¨ë¦¬ 500MB)ìœ¼ë¡œ ì¸í•´ ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ ê³ ê°ˆ ë° ì²˜ë¦¬ í•œê³„ ì´ˆê³¼.



## ğŸ§© ì‹œìŠ¤í…œ í•œê³„

* **Local í™˜ê²½ í…ŒìŠ¤íŠ¸**
  * í…ŒìŠ¤íŠ¸ëŠ” **ë‹¨ì¼ ë…¸ë“œ í™˜ê²½**ì—ì„œ ìˆ˜í–‰ë˜ë©°, **ì„œë²„ ë¶„ë¦¬**ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ íŠ¸ë˜í”½ ì§‘ì¤‘ ì‹œ **ìì› ê²½ìŸ(resource contention)**ìœ¼ë¡œ ì¸í•´ ì „ë°˜ì ì¸ ì„±ëŠ¥ ì €í•˜ ë° ì²˜ë¦¬ ì§€ì—°(latency)ì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
  * ë³¸ í…ŒìŠ¤íŠ¸ëŠ” **ì‹œìŠ¤í…œì˜ ì²˜ë¦¬ í•œê³„(capacity limit)**ì™€ **ìµœì  ì‚¬ìš©ì ìš”ì²­ ì²˜ë¦¬ëŸ‰(optimal throughput)**ì„ ì‹ë³„í•˜ì—¬, **í™•ì¥ì„±(scalability)** ë° **ì„±ëŠ¥ íŠœë‹(performance tuning)**ì„ ìœ„í•œ ê°œì„  ë°©í–¥ì„ ë„ì¶œí•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤.



## ğŸ§© ì‹œìŠ¤í…œ ê°œì„ 

#### 1. ìºì‹± ì „ëµ ìµœì í™”

* Redis ìºì‹± ë°ì´í„° ë²”ìœ„ë¥¼ ì¶•ì†Œí•˜ê³ , ìì£¼ í˜¸ì¶œë˜ëŠ” ë°ì´í„°ë§Œ ì„ ë³„ì ìœ¼ë¡œ ìºì‹±.
* í˜ì´ì§€ ë‹¨ìœ„ ìºì‹±ì„ ì ìš©í•´ Redis ë° ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ë¶„ì‚°.

#### 2. ë¦¬ì†ŒìŠ¤ ì¦ì„¤

* **CPU**ì™€ **ë©”ëª¨ë¦¬**ë¥¼ ìš”ì²­ ì²˜ë¦¬ëŸ‰ì— ë§ê²Œ ì¦ì„¤(CPU 2 core, ë©”ëª¨ë¦¬ 1GB ì´ìƒ).
* JVM í™ ë©”ëª¨ë¦¬ ì„¤ì • ìµœì í™”(`-Xms768m -Xmx1g`)ë¡œ OutOfMemoryError ë°©ì§€.

#### 3. connection poll ì¶”ê°€

* HikariCPë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬.



## ğŸ§© ì¶”ê°€ ê°œì„  ì „ëµ

#### 1. ì„œí‚· ë¸Œë ˆì´ì»¤ ë„ì…

* **ìŠ¬ë¼ì´ë”© ìœˆë„ìš°(sliding window)**ë¥¼ í™œìš©í•´ ì„ê³„ì¹˜ë¥¼ ì´ˆê³¼í•œ ìš”ì²­ì„ ê°ì§€í•˜ê³ , ì¥ì•  ë°œìƒ ì‹œ ìš”ì²­ì„ ì œí•œ.
* íŠ¹ì • ë…¸ë“œì˜ ê³¼ë¶€í•˜ë¥¼ ë°©ì§€í•˜ê³  ì „ì²´ ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒì„ ìœ„í•´ ì ìš©

#### 2. í´ëŸ¬ìŠ¤í„° ìŠ¤ì¼€ì¼ë§ (Cluster Scaling)

* Redis Cluster ë¥¼ êµ¬ìƒí•´ ì¥ì•  ë°œìƒ ì‹œì—ë„ **ê³ ê°€ìš©ì„±(High Availability, HA)**ì„ ìœ ì§€í•˜ë„ë¡ í´ëŸ¬ìŠ¤í„°ë§ ì ìš©

#### 3. High Associativity êµ¬ì¡° 

* ë°ì´í„° íŒŒí‹°ì…”ë‹(Sharding)ì„ í†µí•´ ìš”ì²­ì´ ë¶„ì‚°ë˜ë„ë¡ ì„¤ì •



## ğŸ§© ì„ ì • ì‚¬ìœ 

#### ëŒ€ê¸°ì—´ ìƒì„±

* **ì„ ì • ì‚¬ìœ :**
  
  * SPOF > ëŒ€ê¸°ì—´ ìƒì„±ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•Šìœ¼ë©´ í›„ ë¡œì§ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥
  
* **ì£¼ìš” í…ŒìŠ¤íŠ¸:**
  
  * ë¶„ë‹¹ ìµœëŒ€ ë™ì‹œ ì‚¬ìš©ì ìˆ˜ íŒŒì•… 
    ```
    ì¸ê¸° ì½˜ì„œíŠ¸ì˜ ê²½ìš° ë™ì‹œ ì ‘ì†ì ìˆ˜ê°€ ìˆ˜ ë§Œëª… ì´ìƒ ëª°ë¦¬ê²Œ ëœë‹¤. ë”°ë¼ì„œ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë¶„ë‹¹ ë™ì‹œ ì ‘ì†ì ìˆ˜ë¥¼ 10,000 ëª… ì„¤ì •í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìµœëŒ€ ë™ì‹œ ì ‘ì†ì ìˆ˜ë¥¼ íŒŒì•…í•˜ë ¤ í•œë‹¤.
    ```
  
  * ë¶„ë‹¹ ìµœì  ë™ì‹œ ì‚¬ìš©ì ìˆ˜ íŒŒì•…
  
    ```
    1ì´ˆ ì´ë‚´ ì‘ë‹µ ê°€ëŠ¥í•œ ìµœì  ë™ì‹œ ì ‘ì†ì ìˆ˜ë¥¼ íŒŒì•…í•œë‹¤.
    ```
  
  * ê³ ìœ  ëŒ€ê¸°ì—´ í† í° ë°œê¸‰ í™•ì¸
  
    ```
    return ì´ ì œëŒ€ë¡œ í‘œì¶œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
    ```
  
  * ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ë¶„ì„
  
    ```
    ì‹œìŠ¤í…œ ë¶€í•˜ê°€ ê±¸ë¦¬ëŠ” ì •ë„ë¥¼ íŒŒì•…í•˜ê³ ì í•œë‹¤.
    ```
  
    

#### ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ

* **ì„ ì • ì‚¬ìœ :**
  * ìºì‹œ ì„±ëŠ¥ í™•ì¸
  * ì¼ì •í•œ ì‘ë‹µì‹œê°„ í™•ì¸
  
* **ì£¼ìš” í…ŒìŠ¤íŠ¸:**
  * ìºì‹œ íˆíŠ¸ìœ¨	
  
    ```
    ìºì‹œ ë¯¸ìŠ¤ë¥¼ ìµœëŒ€í•œ ì¤„ì´ê¸° ìœ„í•´ ë…¸ë ¥í•œë‹¤.
    ```
  
  * ì‘ë‹µ ì‹œê°„ ë¶„í¬
  
    ```ã…‚
    ë™ì‹œì ‘ì†ìê°€ 10,000 ì´ìƒ ë“¤ì–´ì˜¨ ê²½ìš° ì‘ë‹µ ì‹œê°„ì´ ë™ì¼í•˜ê²Œ í˜¸ì¶œë˜ëŠ”ì§€ í™•ì¸í•˜ê³ ì í•œë‹¤.
    ```
  
  

#### ëŒ€ê¸°ì—´ ìƒì„± > ì½˜ì„œíŠ¸ ì¼ì • ì¡°íšŒ

* **ì„ ì • ì‚¬ìœ :**
  
  * ëŒ€ê¸°ì—´ ì§„ì… í›„ ìµœì´ˆ ì ‘ì†í•˜ê²Œ ë˜ëŠ” API. 10ì´ˆë‹¹ ì ‘ì†ì ìˆ˜ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ ì„ ì •
  * ì¸ë±ìŠ¤ ì¡°íšŒ ì„±ëŠ¥ ë¶„ì„
  
* **ì£¼ìš” í…ŒìŠ¤íŠ¸:**
  
  * ìµœëŒ€ ë™ì‹œ ì ‘ì†ì ìˆ˜ íŒŒì•…
  
    ```
    ì´ìš©ìëŠ” í´ë§ì„ í†µí•´ ëŒ€ê¸°ì—´ì— ì§„ì… í›„ ì¼ì •ì„ ì¡°íšŒ í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ë¶„ë‹¹ ìµœì†Œ ë™ì‹œ ì ‘ì†ì ìˆ˜ëŠ” 6,000ëª…ìœ¼ë¡œ ì„ ì •í•œë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ìµœì  ë™ì‹œ ì ‘ì†ì ìˆ˜ë¥¼ íŒŒì•…í•œë‹¤.
    ```
  
  * ìµœì  ë™ì‹œ ì ‘ì†ì ìˆ˜ íŒŒì•…
  
    ```
    ëŒ€ê¸°ì—´ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆëŠ” ìµœì  ì‚¬ìš©ì ìˆ˜ë¥¼ íŒŒì•…í•œë‹¤.
    ```



## ğŸ§© ì£¼ìš” í…ŒìŠ¤íŠ¸ í™•ì¸ 

* **http_req_connecting** : ì‘ë‹µ ì‹œê°„
* **P90** : 90% ì‚¬ìš©ì í‰ê·  ì‘ë‹µ ì‹œê°„
* **P95** : 95% ì‚¬ìš©ì í‰ê·  ì‘ë‹µ ì‹œê°„



## ğŸ§© ëŒ€ê¸°ì—´ ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```javascript
import http from 'k6/http';
import { check, sleep, fail } from 'k6';

export let options = {
    startVUs: 0, // ì‹œì‘ VU ìˆ˜
    stages: [
    { duration: '15s', target: 200 },
    { duration: '15s', target: 450 },
    { duration: '15s', target: 200 },
    { duration: '15s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(90)<1000', 'p(95)<1000'], // 90% : 1ì´ˆ ë¯¸ë§Œ/ 99% : 1ì´ˆ ë¯¸ë§Œ
        http_req_failed: ['rate<0.01'],                  // ì‹¤íŒ¨ìœ¨ : 1% ë¯¸ë§Œ
        checks: ['rate>0.99'],                           // ì „ì²´ ìš”ì²­ ì„±ê³µë¥  : 99% ì´ìƒ
    },
    ext: {
      influxdb: {
        enabled: true,
        address: 'http://localhost:8086', 
        database: 'k6'
      },
    }
};

const BASE_URL = 'http://localhost:8081/api/v1';
const userIdStart = 36;
const MAX_RETRIES = 5;

// ëŒ€ê¸°ì—´ í† í° ë°œê¸‰
function issueWaitingTokenWithRetry(userId) {
    let retries = 0;
    let response;
    let success = false;

    while (retries < MAX_RETRIES && !success) {
        response = http.post(`${BASE_URL}/user/${userId}/queue/token/issue`);
        success = check(response, {
            'í† í° ë°œê¸‰ ì„±ê³µ': (r) => r.status === 200,
        });

        if (!success) {
            retries++;
            sleep(1); 
        }
    }
    
    const responseBody = response && response.body ? response.json() : null;

    if (!success) {
        fail(`UserId: ${userId} ì¬ì‹œë„ íšŸìˆ˜: ${MAX_RETRIES}, ìƒíƒœ ì½”ë“œ ${responseBodystatus}, ì‘ë‹µ: ${responseBody.body}`);
    }

    return responseBody ? responseBody.waitingToken : null;
}

export default function () {
    let userId = userIdStart + __VU;    
    issueWaitingTokenWithRetry(userId);
}
```



### **ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ì£¼ìš” ê´€ì  í¬ì¸íŠ¸: ì‘ë‹µ ì„±ê³µ`

* 6,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjdfMTcg/MDAxNzMyNzE0Mjg1Mzky.tiR5OJBDYaDkXKujS8XfR4vO0Tzedjx59o1jxEdWw54g.TzvQY7iG2LDjYBBgqTiQ6rxQ5eaEKtVkNawu1Mx0GB4g.PNG/image.png?type=w773)

* 12,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjdfMTgw/MDAxNzMyNzE1MjM4MDQ2.jmU2CTv4IiJBbcp618xoJZB73goPOfr9bkAkGuhTU1Yg.JcDPGbTf9_0xnv9LYXiKeN18VEUSMwmWSy9dHgK7OeMg.PNG/image.png?type=w773)

* 18,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjdfMjI3/MDAxNzMyNzE1NjQxOTU5.z6TvVBugGmqvDi_GllVQ0H92BlvIM9dwzrlbr6wPsL4g.SPmZ7gcYAZLt5xb9HO-jQ8xTenAKMRnrvO2AjVLW0Rkg.PNG/image.png?type=w773)

```
user ìˆ˜ê°€ ì¦ê°€ë˜ë©´ì„œ ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë‚˜íƒ€ë‚œë‹¤.
```

```shell
error="Post \"http://localhost:8081/api/v1/user/5490/queue/token/issue\": dial tcp 127.0.0.1:8081: connectex: Only one usage of each socket address (protocol/network address/port) is normally permitted."
```

#### ì›ì¸

* ê³¼ë„í•œ ë™ì‹œ ìš”ì²­

#### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœëŒ€ ìœ ì €ìˆ˜ëŠ” 12,000 ëª…ìœ¼ë¡œ ë¶„ì„**
* ì´ë¥¼ ì´ˆê³¼í•˜ë©´ ì‹œìŠ¤í…œì´ ì•ˆì •ì ìœ¼ë¡œ ì‘ë‹µí•˜ì§€ ëª»í•˜ê³ , ë„¤íŠ¸ì›Œí¬ ìì›ì´ í¬í™” ìƒíƒœê°€ ëœë‹¤.



### **ìµœì  ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ê³µí†µ í…ŒìŠ¤íŠ¸: P90 < 1s / P95 < 1s`

* user 150

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMTEg/MDAxNzMyODI0ODI2NzQ1.febTMPEbCY8NT072_RqPHNU7mlw_6iSOmJZtvUoQ_PMg.GuIphZeU29c1PWCvhL3M7AENeVvI6Ji0nLih_xo51pEg.PNG/image.png?type=w773)

* user 350

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjY3/MDAxNzMyODI0ODUwNDU0.xkDRElcegZ3BaoLcgVlfriEhSrAP6bWM6kParZVk6WAg.HvZOOFcidXF4O9VRHouMISqTtDoAxaJE1SWDD6afJL4g.PNG/image.png?type=w773)

* user 400

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMTM3/MDAxNzMyODI0ODY2Mjgz.Q2nJLVcfi-ApRz4orzE1rxsa-7da-gXicTI1VtP6RJkg.Re5joK5QDTxolTCqd5FnrXIhR130vCFunptdtsNHA3Eg.PNG/image.png?type=w773)

* user 450

![img](https://postfiles.pstatic.net/MjAyNDExMjlfNzMg/MDAxNzMyODI0OTM5MDM4.-ByKj27GitUeR1pImaY3HmJZigIceIcXAlmbP-irTtgg.uHyq9W_bSc1PU_iryLB80q9B_EW3UTDTtBb5zTfMB88g.PNG/image.png?type=w773)

### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœì  ìœ ì €ìˆ˜ëŠ” 400ëª…ìœ¼ë¡œ ë¶„ì„**
* P90, P95 ì‘ë‹µ ì‹œê°„ì´ ëª¨ë‘ 1ì´ˆ ì´ë‚´ë¡œ ìœ ì§€ë˜ë©° ì•ˆì •ì ì¸ ì„±ëŠ¥ì„ ë‚˜íƒ€ë‚¸ë‹¤.



### ìµœëŒ€ VS ìµœì  ì‹œê°„ ê²°ê³¼

| **í•­ëª©**             | **ìµœëŒ€ ì‚¬ìš©ì ìˆ˜** | **ìµœì†Œ ì‚¬ìš©ì ìˆ˜** |
| -------------------- | ------------------ | ------------------ |
| **ë¶€í•˜ ì¡°ê±´**        | 12,000 VU          | 400 VU             |
| **ì‘ë‹µ ì‹œê°„ ë¹„êµ**   | -                  | -                  |
| - **í‰ê·  ì‘ë‹µ ì‹œê°„** | 25.98s             | 0.44s              |
| - **p90 ì‘ë‹µ ì‹œê°„**  | 47.84s             | 0.79s              |
| - **p95 ì‘ë‹µ ì‹œê°„**  | 50.94s             | 0.97s              |

* ë™ì‹œ ìš”ì²­ ì¦ê°€ë¡œ ìµœëŒ€ ì‚¬ìš©ì ìˆ˜ê°€ ì¦ê°€ ì‹œ í‰ê·  ì‘ë‹µì‹œê°„ì´ í˜„ì €íˆ ê°ì†Œí•˜ì˜€ë‹¤. 
* **ìŠ¤ì¼€ì¼ë§ ì „ëµ**
  * **Auto Scaling **ì„ ì‚¬ìš©í•´ ë™ì‹œ ìš”ì²­ ì¦ê°€ ì‹œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” ë°©ì•ˆì„ ì´ìš©í•´ ìµœëŒ€ ìš”ì²­ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤.



## ğŸ§© ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```javascript
import http from 'k6/http';
import { check, sleep, fail } from 'k6';

export let options = {
    startVUs: 0, // ì‹œì‘ VU ìˆ˜
    stages: [
    { duration: '15s', target: 500 },
    { duration: '15s', target: 900 },
    { duration: '15s', target: 500 },
    { duration: '15s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(90)<1000', 'p(95)<1000'], // 90% : 1ì´ˆ ë¯¸ë§Œ/ 99% : 1ì´ˆ ë¯¸ë§Œ
        http_req_failed: ['rate<0.01'],                  // ì‹¤íŒ¨ìœ¨ : 1% ë¯¸ë§Œ
        checks: ['rate>0.99'],                           // ì „ì²´ ìš”ì²­ ì„±ê³µë¥  : 99% ì´ìƒ
    },
    ext: {
      influxdb: {
        enabled: true,
        address: 'http://localhost:8086', 
        database: 'k6'
      },
    }
};

const BASE_URL = 'http://localhost:8081/api/v1';

const MAX_RETRIES = 5;

// ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ
function concertListRetry() {
    let retries = 0;
    let response;
    let success = false;

    while (retries < MAX_RETRIES && !success) {
        response = http.get(`${BASE_URL}/concerts/query`);
        success = check(response, {
            'ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ': (r) => r.status === 200,
        });

        if (!success) {
            retries++;
            sleep(1); 
        }
    }

    if (!success) {
        fail(`ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ì¬ì‹œë„ íšŸìˆ˜ ${MAX_RETRIES}, ìƒíƒœ ì½”ë“œ ${response.status}, ì‘ë‹µ: ${response.body}`);
    }
}

export default function () {  
    concertListRetry();
}
```



### **ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ì£¼ìš” ê´€ì  í¬ì¸íŠ¸: ì‘ë‹µ ì„±ê³µ`

* 10,000 user

#### ì—ëŸ¬ ë°œìƒ

```shell
io.netty.handler.codec.DecoderException: java.lang.IllegalStateException: Can't decode replay: +PONG

org.springframework.dao.QueryTimeoutException: Redis command timed out

Caused by: java.lang.OutOfMemoryError: Java heap space
```

#### ì›ì¸ ë¶„ì„

* **Redis ë¶€í•˜**:
  - 1ë§Œ ê±´ ì´ìƒì˜ ì½˜ì„œíŠ¸ ì •ë³´ë¥¼ Redisì— ìºì‹±í•˜ë©´ì„œ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê¸‰ì¦**í•˜ê³ , ìºì‹œ ì¡°íšŒê°€ ëŠë ¤ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒ.
  - Redisì˜ **ë©”ëª¨ë¦¬ ì œí•œ ì •ì±…(Eviction Policy)** ë¯¸ì ìš©ìœ¼ë¡œ ë©”ëª¨ë¦¬ê°€ ê³ ê°ˆë˜ê³ , ìºì‹œ ì ‘ê·¼ ì†ë„ê°€ ì €í•˜ë¨.
* **ë„¤íŠ¸ì›Œí¬ ë³‘ëª©**:
  - ëŒ€ëŸ‰ì˜ Redis ë°ì´í„° ì‘ë‹µìœ¼ë¡œ ì¸í•´ **I/O ì²˜ë¦¬ ì§€ì—°**ì´ ë°œìƒ.
  - ë„¤íŠ¸ì›Œí¬ ë³‘ëª© í˜„ìƒ(Network Bottleneck)ìœ¼ë¡œ ìš”ì²­ì´ ì§€ì—°ë˜ë©´ì„œ `Redis command timed out` ì˜¤ë¥˜ ë°œìƒ.


#### í•´ê²° ë°©ì•ˆ

1. **[ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ ì‹œ 10,000 ê±´ ì¡°íšŒ.](https://github.com/crimsorry/hhplus-concert-service/blob/main/docs/%EC%BD%98%EC%84%9C%ED%8A%B8%20%EC%BF%BC%EB%A6%AC%20%EC%84%B1%EB%8A%A5%20%EA%B0%9C%EC%84%A0.md)** 
   * í•´ê²° ë°©ì•ˆ
     * ì½˜ì„œíŠ¸ ëª©ë¡ ì¡°íšŒ ì‹œ, **1í˜ì´ì§€ë‹¹ 10ê±´**ì˜ ë°ì´í„°ë¥¼ ìºì‹±.
   * ì‚¬ìœ 
     * í˜ì´ì§€ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ìºì‹±í•˜ì—¬, ì‚¬ìš©ì ìš”ì²­ ì‹œ í•œ ë²ˆì— ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë°ì´í„° ì–‘ì„ ìµœì†Œí™”.
     * ì‚¬ìš©ìê°€ ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ ì—´ëŒí•´ë„ Redisì™€ ë„¤íŠ¸ì›Œí¬ì˜ ë¶€ë‹´ì´ í¬ê²Œ ì¤„ì–´ë“¤ë©°, ìºì‹± ë°ì´í„° í¬ê¸°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥.
2. ë¦¬ì†ŒìŠ¤ ë¶€ì¡±
   * í•´ê²° ë°©ì•ˆ
     * JVM í™ ë©”ëª¨ë¦¬ ì„¤ì • `"-Xms512m -Xmx768m"`
     * memory 500m > 1g ë³€ê²½
   * ì‚¬ìœ 
     * ìºì‹± ëª©ë¡ì„ ì¤„ì—¬ë„ ë¦¬ì†ŒìŠ¤ ì—ëŸ¬ê°€ ë‚˜ëŠ” ê²½ìš° ì •í™•í•œ ì›ì¸ íŒŒì•…ì„ ìœ„í•´ heap memory ì„¤ì •ê³¼ docker memory ì„¤ì •ì„ ë³€ê²½í•´ ê°ê°ì˜ ê²½ìš°ì˜ ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ê³ ì í•œë‹¤.

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

1. ìºì‹± ê°œì„  : 10,000 ê±´ > 1í˜ì´ì§€ 10ê±´

[1í˜ì´ì§€ 10ê±´]

* 6,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjhfMTQ2/MDAxNzMyNzMwNDAxMTg5.XGziHgQtx3-PzAybPYCg-AAajJfDa1AxEVTFHbA5aaMg.k0EaTLmDu_DV9DY6MKXq4XXCqWeJ0yVZGlldxRJH_3Yg.PNG/image.png?type=w773)

[1í˜ì´ì§€ 10ê±´]

* 12,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjhfMTky/MDAxNzMyNzMwOTk2MTMz.5Wosow8U66SB5Ut0HUtgoSu4jAO9FhO7RfE059b3A5gg.hl1TWzG5_bLx7unsjpFDCKXjW5GlP0NnnqaW_YerDocg.PNG/image.png?type=w773)

#### ì—ëŸ¬ ë°œìƒ

```shell
[isson-timer-6-1] o.r.c.handler.PingConnectionHandler      : Unable to send PING command over channel: [id: 0x2ca1ac18, L: - R:/:6379]
```

* ë²„ì „ ì´ìŠˆ ë¬¸ì œ í™•ì¸ í›„ redis image ë²„ì „ ìµœì‹ í™”

![img](https://postfiles.pstatic.net/MjAyNDExMjhfMjk5/MDAxNzMyNzMzMzk0NTEx.a2N-3i7K-_o25sQVRDgM9TQJwf4ZJQlpqmTDprCwySog.vUJXauP7UNwkJRg5LaEIn_itQK_e99PRh_Q_AM-dQG0g.PNG/image.png?type=w773)

#### **ë²„ì „ ì—…ë°ì´íŠ¸ ìˆ˜í–‰**

```
redis version 6.3.0 > redis:7.4.1
```

#### ì—…ë°ì´íŠ¸ í›„ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

`ì£¼ìš” ê´€ì  í¬ì¸íŠ¸: ì‘ë‹µ ì„±ê³µ`

* 6,000 user

![image-20241128035644054](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20241128035644054.png)

#### ë¬¸ì œë°œìƒ

* ì‘ë‹µì‹œê°„ ì§€ì—°

| ì¼€ì´ìŠ¤    | ì´ì „     | ì´í›„      |
| --------- | -------- | --------- |
| user      | 6,000 VU | 10,000 VU |
| ì‘ë‹µì‹œê°„  | 6.16s    | 9.74s     |
| ìºì‹œ ë¯¸ìŠ¤ | 5ê±´      | 24ê±´      |

![img](https://postfiles.pstatic.net/MjAyNDExMjhfNCAg/MDAxNzMyNzM1MTc4MDM5.lmrLo6NZaQsHRGD-mkI50ufKY61xm60loNokw9DPLvAg.4bGRx3da597dzeYeDujTjlIFtA-b4AZWQzP07IfqWzMg.PNG/image.png?type=w773)



### ë³‘ëª© ì§€ì  ë¶„ì„ 1. ìºì‹± ì „ëµ ë¶€ì¬

ì½˜ì„œíŠ¸ ì¡°íšŒì— ìºì‹œê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ë”°ë¼ì„œ ìºì‹œ ì„¤ì •ì„ í•´ì œí•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ë‹¤.

![img](https://postfiles.pstatic.net/MjAyNDExMjhfMjEy/MDAxNzMyNzM2MTU4OTk5.WVytisje7bUqMqWLMEUiL2OjM--PNAJI1-sNTXFbcX0g.Z5lPWYFBCIpxOVw0hrlKP-2gfx5vFo9Wes1YI4Sim7Ag.PNG/image.png?type=w773)

* ê²°ê³¼ì ìœ¼ë¡œ ê¸°ì¡´ì— ë¹„í•´ ë‚®ì€ ì‘ë‹µë¥ ê³¼ ë‚®ì€ ì„±ê³µ íšŸìˆ˜ë¥¼ ë³´ì—¬ì£¼ì—ˆë‹¤.
* ìºì‹œ ë¯¸ì ìš© X



### ë³‘ëª© ì§€ì  ë¶„ì„ 2. ìºì‹œ ë¯¸ìŠ¤ë¡œ ì‹œê°„ ì¦ê°€

ìºì‹œ ë¯¸ìŠ¤ íšŸìˆ˜ê°€ ì¦ê°€ë˜ë©´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ë˜ì–´ ì„±ëŠ¥ì´ í•˜ë½í•˜ì˜€ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ. 

**ìºì‹œ ì„œë²„ ë©”ëª¨ë¦¬ ìš©ëŸ‰ì„ ëŠ˜ë ¤ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œë„**

* cpu 1 core > 2 core ë³€ê²½
* memory 500g > 2g ë³€ê²½

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjQ0/MDAxNzMyODI0OTgxMjAw.UQN7KF6rcXE4rZCrhXY9Cbk497IIrsCKDLij7V9nzagg.fXGKDo0PQi46KRStNEf_WBVQ0Fb35-3sEDV4HqNzzGMg.PNG/image.png?type=w773)

* ê²°ê³¼ì ìœ¼ë¡œ userê°€ 15,000 ëª…ì¼ ê²½ìš° ìµœì†Œ 9s ~ ìµœëŒ€ 11s ì‚¬ì´ ê²°ê³¼ê°’ì´ ë‚˜ì˜¤ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸. 
* ì„±ëŠ¥ ì´ìŠˆ X

### ë³‘ëª© ì§€ì  ë¶„ì„ 3. ìœ ì € ìˆ˜ ì¦ê°€ ë¬¸ì œ

user ë¥¼ 6,000 ëª…, 10,000 ëª…ìœ¼ë¡œ ì¦ê°€ ì‹œì¼°ê¸° ë•Œë¬¸ì— ìºì‹œ ë¯¸ìŠ¤ê°€ ëŠ˜ì–´ê°„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ. 

* 6,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMTE3/MDAxNzMyODI0OTk1NDE0.6Uz0DAHLHM7_eKc_F6dd4i4xDhFJf9RnCjG3801nGp8g.hzYqN-Q4vPSjGfr2lOK4iU1241wfFNCtjLd9Vo894fwg.PNG/image.png?type=w773)

* 7,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMTU5/MDAxNzMyODI1MDA4OTE2.FZ6PZzonXgZHpKgvpZ0P8QhDZZ3vtMb5zTAQlTAdK-sg.WMlWqYpZq0jZymTeTahp6PU5xMM2Z4hfPmwlKT-MErog.PNG/image.png?type=w773)

* 8,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjQ5/MDAxNzMyODI1MDIzNzU0.VZB1M6YsQknBWtTJr2VjnAR8xJYWaAdZJsJfK_-W1EEg.F72g81amZRkbpR4JDTH7j4VF1AfOOEf9TGNUjd44dHAg.PNG/image.png?type=w773)

* 9,000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfNTIg/MDAxNzMyODI1MDQzNTA4.Sm5jafU9GyTOod49f5-7qk3nJzaZkcAZDDAcpktnUfwg.BAGzrrzreLYMU47xLX1geYnMjhuZXhHIOV8Ml2z5QHkg.PNG/image.png?type=w773)

#### ê²°ê³¼

| user  | ì‘ë‹µì‹œê°„(s) | p90(s) | p95(s) |
| ----- | ----------- | ------ | ------ |
| 6,000 | 4.18        | 7.95   | 9.95   |
| 7,000 | 2.45        | 7.54   | 8.77   |
| 8,000 | 4.4         | 7.51   | 21.83  |
| 9,000 | 7.81        | 21.81  | 23.92  |

* user ìˆ˜ê°€ 6,000 ~ 8,000 ì‚¬ì´ ì¼ ë•Œ ì‘ë‹µì‹œê°„ì´ ì¼ì •í•˜ì˜€ìœ¼ë‚˜ 9,000 ì— ë„ë‹¬í•œ ê²½ìš° ì‘ë‹µì‹œê°„ê³¼ p90 ì´ í¬ê²Œ ëŠ˜ì–´ë‚œ ê²ƒìœ¼ë¡œ í™•ì¸. ë˜í•œ p95 ì˜ ê²½ìš° user 8,000 ë¶€í„° í¬ê²Œ ì¦ê°€ ëœ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 

### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœëŒ€ ìœ ì €ìˆ˜ëŠ” 8,000ëª…ìœ¼ë¡œ ë¶„ì„**



### ê¸°íƒ€ ê°€ì„¤

1. **ì„œí‚· ë¸Œë ˆì´ì»¤ ë„ì…**: ì‚¬ìš©ì ìˆ˜ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ìºì‹œ ë¯¸ìŠ¤(cache miss) ë¹„ìœ¨ì´ ìƒìŠ¹í•˜ê³  ìˆë‹¤. íŠ¹íˆ ë™ì‹œ ì ‘ì†ìê°€ 13,000ëª…ì„ ì´ˆê³¼í•  ê²½ìš°, ìºì‹œ ë¯¸ìŠ¤ê°€ ê¸‰ê²©íˆ ì¦ê°€í•˜ì—¬ ì‘ë‹µ ì‹œê°„ì´ í¬ê²Œ ëŠ˜ì–´ë‚˜ê³ , ìµœì•…ì˜ ê²½ìš° ì‘ë‹µ ì‹¤íŒ¨ë¡œ ì´ì–´ì§€ê²Œ ëœë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œí‚· ë¸Œë ˆì´ì»¤(Circuit Breaker) íŒ¨í„´ì˜ ë„ì…ì„ ê²€í† .
2. **Cluster Scaling**: ë…¸ë“œ ì¶”ê°€ë¡œ ë°ì´í„°ë¥¼ ë¶„ì‚°.
3. **High Associativity êµ¬ì¡° ë„ì…**: Redis í´ëŸ¬ìŠ¤í„°ë§ì´ë‚˜ sharding ì‚¬ìš©.



### **ìµœì  ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ê³µí†µ í…ŒìŠ¤íŠ¸: P90 < 1s / P95 < 1s`

* 400 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjcy/MDAxNzMyODI1MDU5MjUz.6aSwCrw5MEqx5OU-tIwncnVID7LMlNiLLNWDQGypxv8g.k40vjiD49UcD9G5ev9CjDPsvtIl-hkcBippEsna8o-Eg.PNG/image.png?type=w773)

* 500 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjA5/MDAxNzMyODI1MDczNjEx.F6eyGizrQTDe_8gnzxF55mlZYmkqKxvXtpjncrKfHL8g.stcFiCH4oOjtiUwL1uEHasZdrp2Mkflvf7rNpA58t7Ag.PNG/image.png?type=w773)

* 900 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMjk4/MDAxNzMyODI1MDk0NzM0.sRh50rNbRcQtl3mbKYyPI85rKQsWtO_Z_RssZpXj2x4g.W9s60gumByofWES1xRJaY7LBPT-esfP94VvqV0r0G54g.PNG/image.png?type=w773)

* 1000 user

![img](https://postfiles.pstatic.net/MjAyNDExMjlfMTcz/MDAxNzMyODI1MTEzMDAx.UMgFz7OGSeAwIUrIIsCj-MrOX8CEGC99HrreK6tBngEg.Ac8Mo-uBFnxZNMVw0pkZdbrR-2e5Nc-szq9B9xDOHqsg.PNG/image.png?type=w773)

### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœì  ìœ ì €ìˆ˜ëŠ” 900ëª…ìœ¼ë¡œ ë¶„ì„**
* P90, P95 ì‘ë‹µ ì‹œê°„ì´ ëª¨ë‘ 1ì´ˆ ì´ë‚´ë¡œ ìœ ì§€ë˜ë©° ì•ˆì •ì ì¸ ì„±ëŠ¥ì„ ë‚˜íƒ€ë‚¸ë‹¤.

### ìµœëŒ€ VS ìµœì  ì‹œê°„ ê²°ê³¼

| **í•­ëª©**             | **ìµœëŒ€ ì‚¬ìš©ì ìˆ˜** | **ìµœì†Œ ì‚¬ìš©ì ìˆ˜** |
| -------------------- | ------------------ | ------------------ |
| **ë¶€í•˜ ì¡°ê±´**        | 8,000              | 900                |
| **ì‘ë‹µ ì‹œê°„ ë¹„êµ**   |                    |                    |
| - **í‰ê·  ì‘ë‹µ ì‹œê°„** | 4.4s               | 0.46s              |
| - **p90 ì‘ë‹µ ì‹œê°„**  | 7.51s              | 0.81s              |
| - **p95 ì‘ë‹µ ì‹œê°„**  | 21.83s             | 0.97s              |

* ëŒ€ê¸°ì„± ìƒì„±ì— ë¹„í•´ ìµœëŒ€ ì‚¬ìš©ì ìˆ˜ëŠ” ì¤„ì–´ë“¤ì—ˆì§€ë§Œ, Redis ìºì‹œë¥¼ ì‚¬ìš©í•´ í‰ê·  ì‘ë‹µì‹œê°„ì´ ìƒë‹¹íˆ ê°ì†Œë˜ì—ˆë‹¤.

* ìµœì  ì‚¬ìš©ì ìˆ˜ëŠ” **ë¶€í•˜ ì¡°ê±´ì´ ì•½ 2ë°° ì¦ê°€**(900ëª…)í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , í‰ê·  ì‘ë‹µ ì‹œê°„ì´ ëŒ€ê¸°ì—´ ìƒì„±ê³¼ ìœ ì‚¬í•œ ìˆ˜ì¤€(0.46s)ìœ¼ë¡œ ë‚˜íƒ€ë‚¨.

* Redis ìºì‹œ í™œìš© ë° íš¨ìœ¨ì ì¸ ë¶€í•˜ ë¶„ì‚° ë•ë¶„ì— ì•ˆì •ì ì¸ ì„±ëŠ¥ ìœ ì§€.

* **ìŠ¤ì¼€ì¼ë§ ì „ëµ**

  * **ë¶„ì‚° ìºì‹œ í´ëŸ¬ìŠ¤í„°ë§** : Redis Clusterë¥¼ êµ¬ì„±í•˜ì—¬ **ìˆ˜í‰ í™•ì¥**(Horizontal Scaling) ì„¤ì •. ë…¸ë“œ ì¥ì•  ì‹œ ê³ ê°€ìš©ì„±(HA) ìœ ì§€.



![image](https://private-user-images.githubusercontent.com/31988854/390899366-68c05a8a-3224-4991-abc1-985062f64384.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU0NzcsIm5iZiI6MTczMjgyNTE3NywicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTkzNjYtNjhjMDVhOGEtMzIyNC00OTkxLWFiYzEtOTg1MDYyZjY0Mzg0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMTkzN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWY5NThmZTY1YWIwYTQyMGY3N2U3YmU2MmI5ZTQxZjI1MDJhNjQxZDFiZTE0ZDUwODFkNzUyZjM5MjcxMDgwYmImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.cWPvD9ZtTAu5pZDn02JFObt56tzgQX7pgoGTm_J6Gt8)



## ğŸ§© ëŒ€ê¸°ì—´ ìƒì„± > ì½˜ì„œíŠ¸ ì¼ì • ì¡°íšŒ

#### í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```javascript
import http from 'k6/http';
import { check, sleep, fail } from 'k6';

export let options = {
    startVUs: 0, // ì‹œì‘ VU ìˆ˜
    stages: [
        { duration: '15s', target: 50 },
        { duration: '15s', target: 80 },
        { duration: '15s', target: 50 }
    ],
    thresholds: {
        http_req_duration: ['p(90)<2000', 'p(95)<2000'], // 90% : 2ì´ˆ ë¯¸ë§Œ/ 99% : 2ì´ˆ ë¯¸ë§Œ
        http_req_failed: ['rate<0.01'],                  // ì‹¤íŒ¨ìœ¨ : 1% ë¯¸ë§Œ
        checks: ['rate>0.99'],                           // ì „ì²´ ìš”ì²­ ì„±ê³µë¥  : 99% ì´ìƒ
    },
    ext: {
      influxdb: {
        enabled: true,
        address: 'http://localhost:8086', 
        database: 'k6'
      },
    }
};

const BASE_URL = 'http://localhost:8081/api/v1';
const userIdStart = 36;
const MAX_RETRIES = 5;

// ëŒ€ê¸°ì—´ í† í° ë°œê¸‰
function issueWaitingTokenWithRetry(userId) {
    let retries = 0;
    let response;
    let success = false;

    while (retries < MAX_RETRIES && !success) {
        response = http.post(`${BASE_URL}/user/${userId}/queue/token/issue`);
        success = check(response, {
            'í† í° ë°œê¸‰ ì„±ê³µ': (r) => r.status === 200,
        }); 

        if (!success) {
            retries++;
            sleep(1); 
        }
    }
    
    const responseBody = response && response.body ? response.json() : null;

    if (!success) {
        fail(`UserId: ${userId} ì¬ì‹œë„ íšŸìˆ˜: ${MAX_RETRIES}, ìƒíƒœ ì½”ë“œ ${responseBodystatus}, ì‘ë‹µ: ${responseBody.body}`);
    }

    return responseBody ? responseBody.waitingToken : null;
}

// ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ì¡°íšŒ
function checkAvailableDatesWithRetry(concertId, waitingToken) {
    let retries = 0;
    let response;
    let success = false;

    while (retries < MAX_RETRIES && !success) {
        let headers = {
            'waitingToken': waitingToken, 
        };

        response = http.get(`${BASE_URL}/concert/${concertId}/date`, { headers });
        success = check(response, {
            'ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ì¡°íšŒ ì„±ê³µ': (r) => r.status === 200,
        });

        if (!success) {
            retries++;
            sleep(1); 
        }
    }

    if (!success) {
        const responseBody = response && response.body ? response.json() : null;
        fail(`ConcertId: ${concertId}, ì¬ì‹œë„ íšŸìˆ˜: ${MAX_RETRIES}, ìƒíƒœ ì½”ë“œ: ${response.status}, ì‘ë‹µ: ${responseBody}`);
    }

    return response;
}


export default function () {
    let userId = userIdStart + __VU; 
    let concertId = 451;           
    let waitingToken = issueWaitingTokenWithRetry(userId);

    // Step 1: ëŒ€ê¸°ì—´ í† í° ë°œê¸‰
    if (!waitingToken) {
        fail('ëŒ€ê¸°ì—´ í† í° ì—†ìŒ')
    }

    // Step 2: (active ìŠ¤ì¼€ì¤„ëŸ¬ ëŒ€ê¸°)
    sleep(40);

    // Step 3: ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ ì¡°íšŒ
    for (let i = 0; i < 5; i++) {
        checkAvailableDatesWithRetry(concertId, waitingToken);
        sleep(1); // í˜¸ì¶œ ê°„ê²©
    }
}
```



### **ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ì£¼ìš” ê´€ì  í¬ì¸íŠ¸: ì‘ë‹µ ì„±ê³µ`

* 600 user

```
10ì´ˆë‹¹ 100ëª…ì”© ìŠ¤ì¼€ì¤„ë§ ì‹œ > ë¶„ë‹¹ ìµœëŒ€ 600ëª…

ëŒ€ê¸°ì—´ ìƒì„±ì—ì„œ ë°í˜€ì§„ ìµœëŒ€ ë™ì‹œ ì ‘ì†ì ìˆ˜ëŠ” 15,000, ì½˜ì„œíŠ¸ ì¡°íšŒì—ì„œëŠ” 12,000 ëª…ì´ë‹¤ (ê·¸ ì´ìƒë„ ê°€ëŠ¥í•˜ì§€ë§Œ ì„±ëŠ¥ ì €í•˜ ë¬¸ì œ)

ì½˜ì„œíŠ¸ì—ëŠ” ë‹¤ìˆ˜ì˜ ì‚¬ëŒì´ ëª°ë¦¬ê¸° ë•Œë¬¸ì— 10ì´ˆë‹¹ ëŒ€ê¸°ì—´ ì§„ì… ì‚¬ìš©ì ìˆ˜ë¥¼ 100ëª…ìœ¼ë¡œ í•œì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì§„í–‰
```

#### ì—ëŸ¬ ë°œìƒ

```shell
Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms (total=10, active=10, idle=0, waiting=27)] 
```

* í™•ì¸ ê²°ê³¼ connection poll ì˜¤ë¥˜ë¡œ ìƒê¸´ ë¬¸ì œ 

| ì´ë¦„    | í˜„í™© | ëœ»                  |
| ------- | ---- | ------------------- |
| total   | 10   | ì „ì²´ ì—°ê²°ì˜ ê°œìˆ˜    |
| active  | 10   | ì‚¬ìš©ì¤‘ì¸ ì—°ê²° ê°œìˆ˜  |
| idle    | 0    | ë†€ê³  ìˆëŠ” ì—°ê²° ê°œìˆ˜ |
| waiting | 27   | ê¸°ë‹¤ë¦¬ëŠ” ìš”ì²­ ê°œìˆ˜  |

#### í•´ê²°

* `maximum-pool-size : 25` ì„¤ì •
  * waiting ìš”ì²­ ê°œìˆ˜ì— ë§ê²Œ ì—°ê²° ê°¯ìˆ˜ ìˆ˜ì •

![image](https://private-user-images.githubusercontent.com/31988854/390899419-88dd00b9-a6bc-4742-ad38-a9b33e899c28.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU1MDksIm5iZiI6MTczMjgyNTIwOSwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk0MTktODhkZDAwYjktYTZiYy00NzQyLWFkMzgtYTliMzNlODk5YzI4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjAwOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTEyMWI4ODY3ZjVjZGFjNzNkMGJiNzI1MmQxZGI3N2Y3YjM5OGU0MTM1YTRlNGFiOTcwMTM0MTI5NTI3MDJiNzUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.uY0r1tjBTTlUNkku9Um-C_mVCtiKFWEbLGLWjBUvHjU)

* 95% ìš”ì²­ì´ ì„±ê³µí•˜ê²Œ ë˜ë©´ì„œ `connection poll waiting : 57 ê±´`ìœ¼ë¡œ í‘œì¶œë˜ì—ˆë‹¤. 

#### ë³‘ëª© ì§€ì  ë¶„ì„

1. **application ë¶€í•˜ ì¡°ì ˆ**
   * ëŒ€ê¸°ì—´ ì§„ì… ìˆ˜ë¥¼ **10ì´ˆë‹¹ 50ëª…**ìœ¼ë¡œ ì œí•œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œë‹¤.
2. **HikariCP í’€ í¬ê¸° ì¡°ì •**
   * ë™ì‹œ ì ‘ì† í’€ì´ ê³ ê°ˆë˜ëŠ” ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ `maximum-pool-size`ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤.
   * í•˜ì§€ë§Œ í’€ í¬ê¸°ë¥¼ ë‹¨ìˆœíˆ ëŠ˜ë¦¬ëŠ” ê²ƒì€ ë‹¨ê¸°ì ì¸ í•´ê²°ì±…ì¼ ë¿, ì¥ê¸°ì ìœ¼ë¡œ ë¶€í•˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê²½ìš° ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì´ ë  ìˆ˜ ì—†ë‹¤.
     * **WHY?:** ì»¤ë„¥ì…˜ í’€ì´ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ë©´ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²° ë¹„ìš©ì´ ì¦ê°€í•˜ì—¬ ì‹œìŠ¤í…œ ìì›(ë©”ëª¨ë¦¬, CPU) ì†Œëª¨ê°€ ì»¤ì§ˆ ê°€ëŠ¥ì„±ì´ ìˆë‹¤. 
3. **ì„œí‚· ë¸Œë ˆì´ì»¤ ë„ì…**
   * ì„œí‚· ë¸Œë ˆì´ì»¤ë¥¼ í™œìš©í•˜ì—¬ ì„ê³„ì¹˜ ë„ë‹¬ ì‹œ **ìŠ¬ë¼ì´ë”© ìœˆë„ìš°(sliding window)**ë¥¼ í†µí•´ ì¥ì•  ìƒí™©ì„ ê°ì§€í•˜ê³ , íŠ¹ì • ì‹œê°„ ë™ì•ˆ ì¼ë¶€ ìš”ì²­ì„ ì°¨ë‹¨í•œë‹¤. 
   * ì´ë¥¼ í†µí•´ ì¥ì• ê°€ ë°œìƒí•œ ë¶€ë¶„ì— ëŒ€í•´ ë¹ ë¥¸ ëŒ€ì²´ ë¡œì§(`Fallback`)ì„ ì‹¤í–‰í•˜ì—¬ ì‹œìŠ¤í…œ ì „ì²´ì˜ ê°€ìš©ì„±ì„ ìœ ì§€í•œë‹¤.
   * ì¼ì • ì‹œê°„ ë™ì•ˆ ëŒ€ê¸°ì—´ API ìš”ì²­ì„ ì°¨ë‹¨í•˜ê³ , ì‚¬ìš©ìì—ê²Œ "ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„"ë¼ëŠ” ë©”ì‹œì§€ë¥¼ ë°˜í™˜.

->  í’€ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ì•ˆì€ ë‹¨ê¸°ì ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìœ¼ë‚˜, ë¶€í•˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•  ë•Œë§ˆë‹¤ í’€ í¬ê¸°ë¥¼ ì¡°ì •í•˜ëŠ” ê²ƒì€ ì ì ˆí•˜ì§€ ì•Šë‹¤.  ë”°ë¼ì„œ **application ë¶€í•˜ë¥¼ ì¡°ì ˆ**í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê³ ì í•œë‹¤.

#### í…ŒìŠ¤íŠ¸

* 300 user


![image](https://private-user-images.githubusercontent.com/31988854/390899459-2f650c16-7879-49ab-8243-2f36787a121c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU1MjUsIm5iZiI6MTczMjgyNTIyNSwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk0NTktMmY2NTBjMTYtNzg3OS00OWFiLTgyNDMtMmYzNjc4N2ExMjFjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjAyNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQwM2QzMTA2MTU4Y2UyZmYzZTQ3MmQ5M2FiODA4MThjNzgxYTI1MDhmN2MzMDhkM2M4ZmFmOTZlOGJjYjExYTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.c6uG66uiTrefzjIhDCMjtQa3WtlWuuC5dHIlnR_pCYA)

### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœëŒ€ ìœ ì €ìˆ˜ëŠ” 300ëª…ìœ¼ë¡œ ë¶„ì„**
* **application ë¶€í•˜**ë¥¼ ì¡°ì ˆí•˜ì—¬ ìµœëŒ€ ìœ ì € ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì˜€ë‹¤.



### **ìµœì  ì²˜ë¦¬ ìš©ëŸ‰ í…ŒìŠ¤íŠ¸**

`ê³µí†µ í…ŒìŠ¤íŠ¸: P90 < 2.5s / P95 < 2.5s`

* 150 user

![image](https://private-user-images.githubusercontent.com/31988854/390899494-9a8ba79f-56c3-425b-8f05-e883989f3891.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU1NTIsIm5iZiI6MTczMjgyNTI1MiwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk0OTQtOWE4YmE3OWYtNTZjMy00MjViLThmMDUtZTg4Mzk4OWYzODkxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjA1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTRhODRkMGE4OWQyYWE4Y2UxMjFlZmVmZjcwNTM5ZDk0ZTU2ZDdlYjFjMzA1MzI4MTdjODdiYTI5OGMzYWVhYTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.spwC3PmOEejS3AxMQGRDRdgc_Ij-_IPNMAoB1zIhhE4)

* 100 user

![image](https://private-user-images.githubusercontent.com/31988854/390899505-8e537047-c0bf-414a-8603-507f0f940700.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU1NTIsIm5iZiI6MTczMjgyNTI1MiwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk1MDUtOGU1MzcwNDctYzBiZi00MTRhLTg2MDMtNTA3ZjBmOTQwNzAwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjA1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIwYjE1YTU1NWY1OTYyNGY4YmRkOTNhNWIyNzVhZTljNmZlNTQ1MjA2ZGM2MDgzMTI3NDI5Mzg5MDE0NTdmNjcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.jsz4o8Ur2_SzL3zDHWwJX0WaGQIPPhh3bEGM9JPsKY4)

* 70 user

![image](https://private-user-images.githubusercontent.com/31988854/390899515-1a7002c4-1da4-4703-b64e-50d2a1a56cbd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU1NTIsIm5iZiI6MTczMjgyNTI1MiwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk1MTUtMWE3MDAyYzQtMWRhNC00NzAzLWI2NGUtNTBkMmExYTU2Y2JkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjA1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI3MjU1OTY2MWIxZTRhMzg3OWJiZjllMTUzMGRmYzFiYzk1NTgyNGQyNzQwYjgyOWRiZWYzOTU1ZThmY2QyOWQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.0OCXifpvGRpiG5hv1RDKE7OXMfYjmVMu3xi1OBWHkVA)

### ê²°ë¡ 

* **ë¶„ë‹¹ ìµœì  ìœ ì €ìˆ˜ëŠ” 70ëª…ìœ¼ë¡œ ë¶„ì„**

### ìµœëŒ€ VS ìµœì  ì‹œê°„ ê²°ê³¼

| **í•­ëª©**             | **ìµœëŒ€ ì‚¬ìš©ì ìˆ˜** | **ìµœì†Œ ì‚¬ìš©ì ìˆ˜** |
| -------------------- | ------------------ | ------------------ |
| **ë¶€í•˜ ì¡°ê±´**        | 300                | 70                 |
| **ì‘ë‹µ ì‹œê°„ ë¹„êµ**   |                    |                    |
| - **í‰ê·  ì‘ë‹µ ì‹œê°„** | 9.71s              | 0.23s              |
| - **p90 ì‘ë‹µ ì‹œê°„**  | 32.08s             | 1.07               |
| - **p95 ì‘ë‹µ ì‹œê°„**  | 38.02s             | 1.61               |

* ë™ì‹œ ìš”ì²­ ì¦ê°€ë¡œ ìµœëŒ€ ì‚¬ìš©ì ìˆ˜ê°€ ì¦ê°€ ì‹œ í‰ê·  ì‘ë‹µì‹œê°„ì´ í˜„ì €íˆ ê°ì†Œí•˜ì˜€ë‹¤. 
* **ìµœì í™” ì „ëµ**
  * **ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ ì¦ê°€**
    * ëª¨ë“  ìš”ì²­ì´ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì§ì ‘ ì „ë‹¬ë˜ë©´ì„œ íŠ¸ë˜í”½ì´ ì§‘ì¤‘ë˜ê³ , ê³¼ë¶€í•˜ê°€ ë°œìƒ.
  * **ìºì‹œ ë¶€ì¬**
    * ìì£¼ í˜¸ì¶œë˜ëŠ” ë°ì´í„°(ë‚ ì§œ ì¡°íšŒ)ê°€ ìºì‹±ë˜ì§€ ì•Šì•„ ë°ì´í„°ë² ì´ìŠ¤ì— ë¶ˆí•„ìš”í•œ ë°˜ë³µ ìš”ì²­ ë°œìƒ.
    * **Redis TTL** ì„¤ì • ë° **Eviction Policy** ì„¤ì •ìœ¼ë¡œ ìì£¼ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì œê±°í•˜ì—¬ ì„±ëŠ¥ ìµœì í™”
  * **ë°ì´í„° ë² ì´ìŠ¤ ìµœì í™”**
    * ì¿¼ë¦¬ì— ì ì ˆí•œ **ì¸ë±ìŠ¤ ìµœì í™”**ê°€ ë¶€ì¡±í•˜ì—¬ ë°ì´í„° ì¡°íšŒ ì‹œ ë¶ˆí•„ìš”í•œ í…Œì´ë¸” ìŠ¤ìº”ì´ ë°œìƒ.
    * ì¸ë±ìŠ¤ ì¶”ê°€ ë° ì¿¼ë¦¬ êµ¬ì¡° ê°œì„ ì„ í†µí•´ ë°ì´í„° ì¡°íšŒ ì†ë„ í–¥ìƒì´ í•„ìš”



![image](https://private-user-images.githubusercontent.com/31988854/390899914-57b93fb9-3b28-4a1a-951d-d71e7743cf8a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzI4MjU3MzEsIm5iZiI6MTczMjgyNTQzMSwicGF0aCI6Ii8zMTk4ODg1NC8zOTA4OTk5MTQtNTdiOTNmYjktM2IyOC00YTFhLTk1MWQtZDcxZTc3NDNjZjhhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDExMjglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMTI4VDIwMjM1MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM3MDgzYjQxZGE3YWU5M2Q1YzhjYTRhYzZjOWY4YzZjYjc3M2RkM2JlZjhjNzc4Njg2NzNiMjYzMjY4MjQ3NzEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.foUrqwcL9afWcKw89EPgrWEHFsvt6_a5BghlukDUUys)



## ğŸ§© ì¥ì•  ëŒ€ì‘ ë¬¸ì„œ (ê°€ìƒ)

#### 1. ì¥ì•  ì‚¬ë¡€ ë° ëŒ€ì‘ ë°©ì•ˆ

**1-1 ë™ì‹œ ìš”ì²­ í­ì¦ ëŒ€ì‘ ì „ëµ**

* **ë¬¸ì œì **: ëŒ€ê·œëª¨ ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•œ ì„œë²„ ë¦¬ì†ŒìŠ¤ ê³ ê°ˆ
* **í•´ê²° ë°©ì•ˆ**: Circuit Breaker íŒ¨í„´ êµ¬í˜„ (Netflix Hystrix, Resilience4j)

**1-2 Redis ê²½í•© ë¬¸ì œ ë°œìƒ**

* **ë¬¸ì œì **: ë™ì‹œ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì¸í•œ Redis ì»¤ë„¥ì…˜ í¬í™”
* **í•´ê²° ë°©ì•ˆ**: Redis ë¶„ì‚°ë½ êµ¬í˜„ or ë¹„ë™ê¸°ì²˜ë¦¬

**1-3 ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜**

* **ë¬¸ì œì **: ëŒ€ëŸ‰ ë™ì‹œ ì¿¼ë¦¬ë¡œ ì¸í•œ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ ì €í•˜
* **í•´ê²° ë°©ì•ˆ**: L2 ìºì‹œ ë„ì… or ì¸ë±ìŠ¤ ìµœì •í™” ë° ì¿¼ë¦¬ íŠœë‹

#### 2. ì¥ì•  ë°œìƒ ëŒ€ì‘ ì „ëµ

**2-1 ì§€ì†ì  ëª¨ë‹ˆí„°ë§**

* **ì‹œìŠ¤í…œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**
  - **ë„êµ¬**: Grafana, Prometheus.
  - ì„œë²„ CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§.
* **ë¡œê·¸ ê¸°ë°˜ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•**
* **ìë™í™”ëœ í—¬ìŠ¤ ì²´í¬**
* **ì¥ì•  ë¡œê·¸ ìˆ˜ì§‘**
